index.jsp

<html>
<body>
<h2><%= "Hello World!" %></h2>
</body>
</html>


AdminLoginServlet.java

package com.proj3.servlet;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;

import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import com.proj3.util.DBConnection;

@WebServlet("/AdminLoginServlet")
public class AdminLoginServlet extends HttpServlet {

    private static final long serialVersionUID = 1L;

    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        String username = request.getParameter("username");
        String password = request.getParameter("password");

        // Validation
        if (username == null || password == null ||
                username.trim().isEmpty() || password.trim().isEmpty()) {

            request.setAttribute("error", "Username and password are required");
            request.getRequestDispatcher("/adminLogin.jsp")
                   .forward(request, response);
            return;
        }

        String sql = "SELECT adminId, username FROM admin WHERE username=? AND password=?";

        try (Connection conn = DBConnection.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {

            ps.setString(1, username);
            ps.setString(2, password);

            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                // SUCCESS
                HttpSession session = request.getSession(true);
                session.setAttribute("adminId", rs.getInt("adminId"));
                session.setAttribute("adminUsername", rs.getString("username"));

                response.sendRedirect(request.getContextPath() + "/views/admin_dashboard.jsp");
            } else {
                // FAILURE
                request.setAttribute("error", "Invalid username or password");
                request.getRequestDispatcher("/adminLogin.jsp")
                       .forward(request, response);
            }

        } catch (SQLException e) {
            throw new ServletException("Database error during admin login", e);
        }
    }
}


DBConnection.java

package com.proj3.util;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DBConnection {

    private static final String URL =
        "jdbc:mysql://localhost:3306/quiz?useSSL=false&serverTimezone=UTC";

    private static final String USER = "root";
    private static final String PASS = "root";

    static {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            System.out.println("MySQL Driver Loaded");
        } catch (ClassNotFoundException e) {
            throw new RuntimeException("MySQL JDBC Driver not found", e);
        }
    }

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(URL, USER, PASS);
    }
}



adminLogin.jsp

<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<html>
<head>
    <title>Admin Login</title>
</head>
<body>

<h2>Admin Login</h2>

<%
    String error = (String) request.getAttribute("error");
    if (error != null) {
%>
    <p style="color:red;"><%= error %></p>
<%
    }
%>

<form action="<%= request.getContextPath() %>/AdminLoginServlet" method="post">
    <label>Username:</label>
    <input type="text" name="username" required /><br><br>

    <label>Password:</label>
    <input type="password" name="password" required /><br><br>

    <input type="submit" value="Login">
</form>

</body>
</html>


web.xml

<?xml version="1.0" encoding="UTF-8"?>
<web-app
    version="4.0"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:javaee="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xml="http://www.w3.org/XML/1998/namespace"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd">
  <display-name>Archetype Created Web Application</display-name>
  
  <welcome-file-list>
    <welcome-file>adminLogin.jsp</welcome-file>
</welcome-file-list>

<servlet>
	
	<servlet-name>AdminLoginServlet</servlet-name>
	<servlet-class>com.proj3.servlet.AdminLoginServlet</servlet-class>
</servlet>
  
</web-app>



Proj3/pom.xml

<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.proj3</groupId>
  <artifactId>Proj3</artifactId>
  <version>0.0.1-SNAPSHOT</version>
  <packaging>war</packaging>

  <name>Proj3 Maven Webapp</name>
  <!-- FIXME change it to the project's website -->
  <url>http://www.example.com</url>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>8</maven.compiler.source>
    <maven.compiler.target>8</maven.compiler.target>
  </properties>

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.13.1</version>
      <scope>test</scope>
    </dependency>
    
    <dependency>
    <groupId>jakarta.servlet</groupId>
    <artifactId>jakarta.servlet-api</artifactId>
    <version>6.1.0</version>
    <scope>provided</scope>
	</dependency>
	
	
	<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
    <version>8.3.0</version>
	</dependency>

	

  </dependencies>

  <build>
    <finalName>Proj3</finalName>
    <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
      <plugins>
        <plugin>
          <artifactId>maven-clean-plugin</artifactId>
          <version>3.4.0</version>
        </plugin>
        <!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging -->
        <plugin>
          <artifactId>maven-resources-plugin</artifactId>
          <version>3.3.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.13.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>3.3.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-war-plugin</artifactId>
          <version>3.4.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-install-plugin</artifactId>
          <version>3.1.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>3.1.2</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>



admin_dashboard.jsp


<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ page session="true" %>

<html>
<head>
    <title>Admin Dashboard</title>
</head>
<body>

<%
    Integer adminId = (Integer) session.getAttribute("adminId");
    String adminUsername = (String) session.getAttribute("adminUsername");

    if (adminId == null) {
        response.sendRedirect("adminLogin.jsp");
        return;
    }
%>



<h2>Welcome Admin: <%= adminUsername %></h2>
<p>Admin ID: <%= adminId %></p>

<a href="logout.jsp">Logout</a>

</body>
</html>


CreateQuizServlet.java


package com.proj3.servlet;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.*;

import java.io.IOException;
import java.sql.*;

import com.proj3.util.DBConnection;

@WebServlet("/CreateQuizServlet")
public class CreateQuizServlet extends HttpServlet {

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        String quizName = request.getParameter("quizName");
        String[] questionIds = request.getParameterValues("questionIds");

        HttpSession session = request.getSession(false);
        int adminId = (int) session.getAttribute("adminId");

        if (quizName == null || questionIds == null) {
            response.sendRedirect("createQuiz.jsp");
            return;
        }

        try (Connection conn = DBConnection.getConnection()) {

            // 1️⃣ Insert Quiz
            String quizSql = "INSERT INTO quizzes (quiz_name, created_by) VALUES (?, ?)";
            PreparedStatement psQuiz =
                    conn.prepareStatement(quizSql, Statement.RETURN_GENERATED_KEYS);

            psQuiz.setString(1, quizName);
            psQuiz.setInt(2, adminId);
            psQuiz.executeUpdate();

            ResultSet rs = psQuiz.getGeneratedKeys();
            rs.next();
            int quizId = rs.getInt(1);

            // 2️⃣ Insert Quiz Questions
            String qqSql = "INSERT INTO quiz_questions (quiz_id, question_id) VALUES (?, ?)";
            PreparedStatement psQQ = conn.prepareStatement(qqSql);

            for (String qid : questionIds) {
                psQQ.setInt(1, quizId);
                psQQ.setInt(2, Integer.parseInt(qid));
                psQQ.addBatch();
            }
            psQQ.executeBatch();

            response.sendRedirect("admin_dashboard.jsp");

        } catch (Exception e) {
            throw new ServletException(e);
        }
    }
}

adminDashboard.jsp

<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ page session="true" %>
<%@ page import="java.sql.*" %>
<%@ page import="com.proj3.util.DBConnection" %>

<html>
<head>
    <title>Admin Dashboard</title>
</head>
<body>

<%
    Integer adminId = (Integer) session.getAttribute("adminId");
    String adminUsername = (String) session.getAttribute("adminUsername");

    if (adminId == null) {
        response.sendRedirect("adminLogin.jsp");
        return;
    }
%>

<h2>Welcome Admin: <%= adminUsername %></h2>
<p>Admin ID: <%= adminId %></p>

<hr>

<h3>Create New Quiz</h3>

<form action="<%= request.getContextPath() %>/CreateQuizServlet" method="post">

    <label>Quiz Name:</label><br>
    <input type="text" name="quizName" required /><br><br>

    <h4>Select Questions:</h4>

    <%
        try (Connection conn = DBConnection.getConnection();
             PreparedStatement ps =
                 conn.prepareStatement("SELECT question_id, question_text FROM questions");
             ResultSet rs = ps.executeQuery()) {

            while (rs.next()) {
    %>
                <input type="checkbox" name="questionIds"
                       value="<%= rs.getInt("question_id") %>">
                <%= rs.getString("question_text") %>
                <br><br>
    <%
            }
        } catch (Exception e) {
            out.println("<p style='color:red'>Error loading questions</p>");
        }
    %>

    <br>
    <input type="submit" value="Create Quiz">
</form>

<hr>

<a href="logout.jsp">Logout</a>

</body>
</html>

